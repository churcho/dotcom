$location-line-width: $space-6;

@mixin stop-bubble-mode-color($class, $color) {
// scss-lint:disable NestingDepth
// scss-lint:disable SelectorDepth
// Changes the color for the stop bubble based on the route type
  .route-stop-list,
  .schedule-trip-info,
  .schedule-v2-timetable {
    &#{$class} {
      .icon-boring,
      .icon-inverse,
      .stop-bubble-stop,
      .stop-bubble-terminus {
        circle {
          fill: $white;
          stroke: $color;
          stroke-width: $space-2;
        }
      }

      .icon-inverse,
      .stop-bubble-terminus {
        circle {
          fill: $color;
        }
      }

      .stop-list-indented::after {
        background-color: $color;
      }

      .stop-bubble::before {
        border-left-color: $color;
      }
    }
  }
}

@mixin stop-bubble-first() {
  .stop-bubble::before {
    // NB: The seemingly magic number 98% keeps the lines long enough
    // to hit the next stop bubble without overlapping and causing
    // visual noise. This may require adjustment if the height of the
    // rows changes in the future
    height: 98%;
    top: $space-2;
  }
}

@mixin stop-bubble-last() {
  .stop-bubble::before {
    display: none;
  }
}

@mixin stop-bubble-collapsed() {
  .stop-bubble {
    &::before {
      border-left-style: dotted;
      border-left-width: $location-line-width;
      // taller and adjusted up so it moves up towards the previous stop
      height: 150%;
      top: -$base-spacing * .75;
    }
  }
}

@mixin stop-info-column() {
  @include unpadded-column;

  display: block;
  margin-left: $base-spacing + $icon-size;
  padding-left: 0;
  width: grid-width(10);

  > span:first-child,
  > span:last-child {
    float: left;
    width: 50%;
  }
}

@mixin stop-bubble-row() {
  @extend %unpadded-table-row;
  background-color: transparent;
  border-bottom: 0;
  border-top: 0;
  position: relative;

  .stop-info {
    @include stop-info-column();
    border-bottom: $border;
    padding-bottom: $base-spacing;
  }
}


.stop-bubble {
  height: 100%;
  padding: $base-spacing-sm 0;
  position: absolute;
  width: $icon-size;

  &::before {
    border-left-style: solid;
    border-left-width: $location-line-width;
    content: '';
    height: 130%;
    left: 40%;
    position: absolute;
    top: -25%;
    z-index: $z-index-stop-bubble-line;
  }

  svg {
    margin-top: -$base-spacing-sm;
    overflow: visible;
    position: absolute;
    z-index: $z-index-stop-bubble;
  }
}

.stop-list-indented {
  padding-left: $icon-size;
  position: relative;

  // Starts in the middle of the line it's indenting from, and goes to the right edge of the indented line.
  $extender-width: $location-line-width + ($icon-size * 1.5);

  .route-stop {
    padding-right: 0;
  }

  &::after {
    content: ' ';
    height: $location-line-width;
    left: $icon-size / 2;
    position: absolute;
    top: 0;
    width: $extender-width;
  }

  .route-stop:first-child {
    //scss-lint:disable NestingDepth
    .stop-bubble:first-child {
      // removes a gap between the top of the indented line and the horizontal extender line.
      &::before {
        top: -$base-spacing / 2;
      }
    }
  }
}

.icon-green-branch-bubble {
  text {
    font-weight: bold;
  }

  &.stop-bubble-terminus {
    text {
      fill: $white;
    }
  }

  &.stop-bubble-stop {
    text {
      fill: $gray-dark;
    }
  }
}

@include stop-bubble-mode-color(".commuter-rail", $brand-commuter-rail);
@include stop-bubble-mode-color(".red-line", $brand-red-line);
@include stop-bubble-mode-color(".blue-line", $brand-blue-line);
@include stop-bubble-mode-color(".orange-line", $brand-orange-line);
@include stop-bubble-mode-color(".green-line", $brand-green-line);
@include stop-bubble-mode-color(".bus", $brand-bus);
@include stop-bubble-mode-color(".ferry", $brand-ferry);
